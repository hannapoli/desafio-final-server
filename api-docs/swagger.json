{
  "openapi": "3.0.3",
  "info": {
    "title": "AgroSync API",
    "description": "Api para la gestión de campos de cultivo",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://localhost:4001",
      "description": "Servidor local"
    },
    {
      "url": "https://agro-sync.onrender.com/",
      "description": "Servidor en producción"
    }
  ], 
  "security": [
    {
      "firebaseAuth": []
    }
  ],
  "tags": [
    {
      "name": "auth",
      "description": "Autenticación y control de sesión"
    },
    {
      "name": "admin",
      "description": "Rutas de administración de usuarios (solo ADMIN)"
    },
    {
      "name": "producer",
      "description": "Rutas del usuario con rol productor"
    },
    {
      "name": "director",
      "description": "Rutas del usuario con rol director"
    },
    {
      "name": "analyst",
      "description": "Rutas del usuario con rol analista"
    },
    {
      "name": "consultant",
      "description": "Rutas del usuario con rol asesor"
    },
    {
      "name": "messages",
      "description": "Rutas del chat"
    },
    {
      "name": "cloudinary",
      "description": "Rutas de la conexión a la nube de cloudinary"
    },
    {
      "name": "reports",
      "description": "Rutas del usuario con rol distribuidor"
    }
  ],
  "paths": {
    "/users/getall": {
      "get": {
        "summary": "Obtener todos los usuarios (solo ADMIN)",
        "tags": ["admin"],
        "responses": {
          "200": {
            "description": "Listado de usuarios",
            "content": {
              "application/json": {
                
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/User" }
                }
              }
            }
          },
          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" }
        }
      }
    },
    "/users/get/{email}": {
      "get": {
        "summary": "Obtener usuario por email (solo ADMIN)",
        "tags": ["admin"],
        "parameters": [
          { "$ref": "#/components/parameters/emailParam" }
        ],
        "responses": {
          "200": {
            "description": "Usuario encontrado",
            "content": {
              "application/json": {
                
                "schema": { "$ref": "#/components/schemas/User" }
              }
            }
          },
          "404": { "$ref": "#/components/responses/NotFoundError" },
          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" }
        }
      }
    },
    "/users/edit/{id}": {
      "put": {
        "summary": "Editar usuario por ID (solo ADMIN)",
        "tags": ["admin"],
        "parameters": [
          { "$ref": "#/components/parameters/idParam" }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "role": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Usuario actualizado correctamente"},
          "404": {"$ref": "#/components/responses/NotFoundError"},
          "401": {"$ref": "#/components/responses/UnauthorizedError"},
          "403": {"$ref": "#/components/responses/UnauthorizedError"}
        }
      }
    },
    "/register": {
      "post": {
        "summary": "Registrar usuarios",
        "tags": [
          "auth"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "properties": {
                  "uid": {
                    "type": "string",
                    "maxLength": 250
                  },
                  "email": {
                    "type": "string",
                    "maxLength": 255
                  },
                  "name": {
                    "type": "string",
                    "minLength": 3,
                    "maxLength": 100
                  },
                  "role": {
                    "type": "string"
                  }
                },
                "required": [
                  "name"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Usuario creado correctamente",
            "content": {
              "application/json": {
                "example": {
                  "ok": true,
                  "msg": "Usuario creado correctamente",
                  "user": {
                    "uid": 1,
                    "email": "Email del usuario",
                    "name": "Nombre del usuario",
                    "role": "Rol del usaurio"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Firebase UID",
            "content": {
              "application/json": {
                "example": {
                  "ok": false,
                  "msg": "Falta firebase uid"
                }
              }
            }
          },
          "409": {
            "description": "Usuario ya registrado",
            "content": {
              "application/json": {
                "example": {
                  "ok": false,
                  "msg": "Error: el usuario con este correo electrónico ya está registrado"
                }
              }
            }
          },
          "500": {
            "description": "Error de servidor",
            "content": {
              "application/json": {
                "example": {
                  "ok": false,
                  "msg": "Error interno del servidor"
                }
              }
            }
          }
        }
      }
    },
    "/users/delete/{id}": {
      "delete": {
        "summary": "Eliminar usuario por ID (solo ADMIN)",
        "tags": ["admin"],
        "parameters": [
          { "$ref": "#/components/parameters/idParam" }
        ],
        "responses": {
          "200": {
            "description": "Usuario eliminado correctamente"
          },
          "404": {"$ref": "#/components/responses/NotFoundError"},
          "401": {"$ref": "#/components/responses/UnauthorizedError"},
          "403": {"$ref": "#/components/responses/UnauthorizedError"}
        }
      }
    },
    "/me": {
      "get": {
        "summary": "Obtener nombre y rol del usuario registrado",
        "tags": [
          "auth"
        ],
        "responses": {
          "200": {
            "description": "Información de usuario obtenida correctamente",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "name": "Nombre de usuario",
                  "role": "Rol del usuario"
                }
              }
            }
          },
          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" }
        }
      }
    },
    "/upload": {
      "post": {
        "summary": "Registrar usuarios",
        "tags": [
          "cloudinary"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Archivos guardados en cloudinary correctamente",
            "content": {
              "application/json": {
                "example": {
                  "ok": true,
                  "msg": "Archivos subidos de forma correcta",
                  "data": "URLS de las imágenes"
                }
              }
            }
          },
          "400": {
            "description": "Archivos no encontrados",
            "content": {
              "application/json": {
                "example": {
                  "ok": false,
                  "msg": "No se han encontrado para subir"
                }
              }
            }
          },
          "500": {
            "description": "Error de servidor",
            "content": {
              "application/json": {
                "example": {
                  "ok": false,
                  "msg": "Error, contacte con el administrador"
                }
              }
            }
          }
        }
      }
    },
    "/delete": {
      "delete": {
        "summary": "Registrar usuarios",
        "tags": [
          "cloudinary"
        ],
        "parameters": [
          {
            "name": "public_id",
            "in": "query",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Archivos eliminados de forma correcta",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "Archivos eliminados de forma correcta",
                  "data": "Información desde cloudinary"
                }
              }
            }
          },
          "400": {
            "description": "Archivos no encontrados",
            "content": {
              "application/json": {
                "example": {
                  "ok": false,
                  "msg": "No se han encontrado archivos para eliminar"
                }
              }
            }
          },
          "500": {
            "description": "Error de servidor",
            "content": {
              "application/json": {
                "example": {
                  "ok": false,
                  "msg": "Error, contacte con el administrador"
                }
              }
            }
          }
        }
      }
    },
    "/dashboard/{id}": {
      "get": {
        "summary": "Obtener todas las parcelas del productor por su ID (solo PRODUCER)",
        "tags": ["producer", "director"],

        "parameters": [
          { "$ref": "#/components/parameters/idParam" }
        ],

        "responses": {
          "200": {
            "description": "Obtener todas las parcelas del usuario por su ID",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "TODO OK",
                  "data": "Datos de la parcela"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/parcel/{id}": {
      "get": {
        "summary": "Obtener información de una parcela por ID (solo PRODUCER)",
        "tags": ["producer", "analyst", "consultant", "director"],

        "parameters": [
          { "$ref": "#/components/parameters/idParam" }
        ],

        "responses": {
          "200": {
            "description": "Obtener información de la parcela por ID",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "TODO OK",
                  "data": "Datos de la parcela"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/parcel/create": {
      "post": {
        "summary": "Crear una nueva parcela (solo PRODUCER)",
        "tags": ["producer"],

        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Nombre de la parcela"
                  },
                  "photo": {
                    "type": "string",
                    "format": "binary",
                    "description": "Imagen de la parcela"
                  }
                },
                "required": ["name"]
              }
            }
          }
        },

        "responses": {
          "201": {
            "description": "Parcela creada correctamente",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Parcel" }
              }
            }
          },

          "400": {
            "description": "Datos inválidos o incompletos"
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/parcel/delete/{id}": {
      "delete": {
        "summary": "Eliminar una parcela por ID (solo PRODUCER)",
        "tags": ["producer"],

        "parameters": [
          { "$ref": "#/components/parameters/idParam" }
        ],

        "responses": {
          "200": {
            "description": "Parcela eliminada correctamente",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "Parcela eliminada correctamente"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "404": { "$ref": "#/components/responses/NotFoundError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/reports/getAll/{email}": {
      "get": {
        "summary": "Obtener todos los reportes de un usuario por email",
        "tags": ["reports"],

        "parameters": [
          { "$ref": "#/components/parameters/emailParam" }
        ],

        "responses": {
          "200": {
            "description": "Listado de reportes del usuario",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "TODO OK",
                  "data": "Datos de los reportes"
                }
              }
            }
      },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/reports/getByID/{idReport}": {
      "get": {
        "summary": "Obtener un reporte por su ID",
        "tags": ["reports"],

        "parameters": [
          { "$ref": "#/components/parameters/idReportParam" }
        ],
        
        "responses": {
          "200": {
            "description": "Reporte encontrado",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "TODO OK",
                  "data": "Datos del reportes"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "404": { "$ref": "#/components/responses/NotFoundError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/reports/create/{email}/{idParcel}": {
      "post": {
        "summary": "Crear un reporte asociado a una parcela, por email",
        "tags": ["reports"],

        "parameters": [
          { "$ref": "#/components/parameters/emailParam" },
          {
            "name": "idParcel",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],

        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "email_creator": {
                    "type": "string"
                  },
                  "email_receiver": {
                    "type": "string"
                  },
                  "content_message": {
                    "type": "string"
                  },
                  "attach": {
                    "type": "string",
                    "format": "binary"
                  }
                },
                "required": ["content_message"]
              }
            }
          }
        },

        "responses": {
          "201": {
            "description": "Reporte creado correctamente",
            "content": {
              "application/json": {
                "example": {
                  "ok": true,
                  "msg": "El reporte está creado",
                  "data": "Datos del reporte"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/reports/update/{idReport}": {
      "put": {
        "summary": "Actualizar un reporte por su ID",
        "tags": ["reports"],

        "parameters": [
          { "$ref": "#/components/parameters/idReportParam" }
        ],

        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "email_receiver": {
                    "type": "string"
                  },
                  "content_message": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },

        "responses": {
          "200": {
            "description": "Reporte actualizado correctamente",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "Reporte actualizado correctamente",
                  "data": "Datos del reporte"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "404": { "$ref": "#/components/responses/NotFoundError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/reports/delete/{idReport}": {
      "delete": {
        "summary": "Eliminar reporte por su ID",
        "tags": ["reports"],

        "parameters": [
          { "$ref": "#/components/parameters/idReportParam" }
        ],

        "responses": {
          "200": {
            "description": "Reporte eliminado correctamente",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "Reporte borrado",
                  "deletedReport": "Datos del reporte"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "404": { "$ref": "#/components/responses/NotFoundError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/dashboard": {
      "get": {
        "summary": "Obtener todas las parcelas (rol ANALYST)",
        "tags": ["analyst"],

        "responses": {
          "200": {
            "description": "Información de las parcelas accesibles por el asesor",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "TODO OK",
                  "data": "Datos de las parcelas"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/dashboard/{email}": {
      "get": {
        "summary": "Obtener todas las parcelas de un usuario por email (rol CONSULTANT)",
        "tags": ["consultant"],

        "parameters": [
          { "$ref": "#/components/parameters/emailParam" }
        ],
        
        "responses": {
          "200": {
            "description": "Parcelas del usuario obtenidas correctamente por su ID",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "TODO OK",
                  "data": "Datos de la parcela"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/getChats/{email}": {
      "get": {
        "summary": "Obtener todos los chats por email del usuario",
        "tags": ["messages"],

        "parameters": [
          { "$ref": "#/components/parameters/emailParam" }
        ],

        "responses": {
          "200": {
            "description": "Chats encontrados correctamente",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "TODO OK",
                  "data": "Datos de los mensajes"
                }
              }
            }
          },
          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/getAll/{email_creator}/{email_receiver}": {
      "get": {
        "summary": "Obtener todos los mensajes entre dos usuarios",
        "tags": ["messages"],

        "parameters": [
          {
            "name": "email_creator",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          },
          {
            "name": "email_receiver",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],

        "responses": {
          "200": {
            "description": "Chats encontrados correctamente",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "TODO OK",
                  "data": "Datos de los mensajes"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/getByID/{idMessage}": {
      "get": {
        "summary": "Obtener un mensaje por su ID",
        "tags": ["messages"],

        "parameters": [
          { "$ref": "#/components/parameters/idMessageParam" }
        ],

        "responses": {
          "200": {
            "description": "Mensaje encontrado correctamente",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "TODO OK",
                  "data": "Mensaje"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/create/{email_creator}/{email_receiver}": {
      "post": {
        "summary": "Enviar un mensaje",
        "tags": ["messages"],

        "parameters": [
          {
            "name": "email_creator",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          },
          {
            "name": "email_receiver",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],

        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "properties": {
                  "content_message": { "type": "string" }
                },
                "required": ["content_message"]
              }
            }
          }
        },

        "responses": {
          "201": {
            "description": "Mensaje enviado correctamente",
            "content": {
              "application/json": {
                "example": {
                  "ok": true,
                  "msg": "Mensaje creado correctamente",
                  "data": "Mensaje creado"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/delete/{idMessage}": {
      "delete": {
        "summary": "Eliminar un mensaje por su ID",
        "tags": ["messages"],

        "parameters": [
          { "$ref": "#/components/parameters/idMessageParam" }
        ],

        "responses": {
          "200": {
            "description": "Mensaje borrado correctamente",
            "content": {
              "application/json": {
                
                "example": {
                  "ok": true,
                  "msg": "mensaje borrado",
                  "deletedMessage": "Mensaje eliminado"
                }
              }
            }
          },

          "401": { "$ref": "#/components/responses/UnauthorizedError" },
          "403": { "$ref": "#/components/responses/UnauthorizedError" },
          "404": { "$ref": "#/components/responses/NotFoundError" },
          "500": { "$ref": "#/components/responses/ServerError" }
        }
      }
    },
    "/deleteAll/{email}": {
      "delete": {
        "summary": "Eliminar todos los mensajes...",
        "tags": ["messages"],
        "parameters": [
          { "$ref": "#/components/parameters/emailParam" }
        ],
        "responses": {
          "200": {
            "description": "Conversación eliminada correctamente",
            "content": {
              "application/json": {
                "example": {
                  "ok": true,
                  "msg": "mensaje borrado",
                  "deletedMessage": "Información de los mensajes"
                }
              }
            }
          } 
        } 
      } 
    } 
  },
  "components": {
    "securitySchemes": {
      "firebaseAuth": { 
        "type": "http", 
        "scheme": "bearer", 
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "uid": {
            "type": "string"
          },
          "email": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "role": {
            "type": "string"
          }
        }
      },
      "Parcel": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "photo_url": {
            "type": "string"
          }
        }
      },
      "Report": {
        "type": "object",
        "properties": {
          "email_creator": {
            "type": "string"
          },
          "email_receiver": {
            "type": "string"
          },
          "content_message": {
            "type": "string"
          },
          "attach": {
            "type": "string",
            "format": "binary"
          }
        }
      },
      "Message": {
        "type": "object",
        "properties": {
          "email_creator": {
            "type": "string"
          },
          "email_receiver": {
            "type": "string"
          },
          "content_message": {
            "type": "string"
          }
        }
      }
    },
    "responses": {
      "UnauthorizedError": {
        "description": "Token inválido o ausente",
        "content": {
          "application/json": {
            "example": {
              "ok": false,
              "msg": "No autorizado"
            }
          }
        }
      },
      "ServerError": {
        "description": "Error interno del servidor",
        "content": {
          "application/json": {
            "example": {
              "ok": false,
              "msg": "Error interno del servidor"
            }
          }
        }
      },
      "NotFoundError": {
        "description": "Recurso no encontrado",
        "content": {
          "application/json": {
            "example": {
              "ok": false,
              "msg": "Recurso no encontrado"
            }
          }
        }
      }
    },
    "parameters": {
      "emailParam": {
        "name": "email",
        "in": "path",
        "required": true,
        "schema": {
          "type": "string"
        }
      },
      "idParam": {
        "name": "id",
        "in": "path",
        "required": true,
        "schema": {
          "type": "string"
        }
      },
      "idReportParam": {
        "name": "idReport",
        "in": "path",
        "required": true,
        "schema": {
          "type": "string"
        }
      },
      "idMessageParam": {
        "name": "idMessage",
        "in": "path",
        "required": true,
        "schema": {
          "type": "string"
        }
      }
    }
  }
}
